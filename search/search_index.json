{"config":{"lang":["en"],"separator":"[\\s]","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Infrastructure as Code","text":"<p>Als kleines Projekt sollst du automatisiert die Konfiguration der Ansible Automation Platform (kurz AAP) anpassen. Die AAP bietet unter anderem ein Web-UI f\u00fcr die einfache Ausf\u00fchrung von Ansible Automatisierung, Hochverf\u00fcgbarkeit, Authentifizierung, Auditing, Logging und vieles mehr. Die AAP selbst kann aber auch \u00fcber eine API automatisiert werden, der Code daf\u00fcr ist als sogenanntes Ansible Playbook bereits erstellt, muss aber angepasst werden.  </p> <p>Success</p> <p>Automate the automation (platform)!</p> <p>Du wirst also in den folgenden drei Teilen den typischen Entwickler-Workflow durchlaufen und mit vielen Tools und Prozessen in Ber\u00fchrung kommen, welche dir tagt\u00e4glich in einem DevOps-Projekt begegnen werden.</p>"},{"location":"part1/","title":"Teil 1 - Vorbereitung","text":"<p>Als erstes bereitest du dir deine Demo/Entwicklungsumgebung vor.</p> <p>Du wirst mit einigen Tools aus einem typischen DevOps-Projekt in Kontakt kommen:</p> <ul> <li>Ansible</li> <li>Ansible Automation Platform</li> <li>Git &amp; Github</li> <li>VS Code</li> </ul> <p>Ansible ist eine Open-Source-IT-Automatisierungs-Engine, welche die Provisionierung, das Config-Management, die Application Deployment, Orchestrierung und viele andere IT-Prozesse automatisiert. Die Ansible Automation Platform ist eine integrierte L\u00f6sung f\u00fcr den Einsatz von Ansible im Unternehmen. Die Plattform umfasst einen Controller mit  Webkonsole und REST-API, Execution Environments, Authentifizierung und RBAC, Logging und Auditing, Credential- und Inventory-Handling, sowie Workflows zur Modellierung und Ausf\u00fchrung der Automatisierung komplexer Prozesse. Git ist der de-facto Standard zur Versionskontrolle von Code und ist integraler Bestandteil jedes Software-getriebenen Projekts. Visual Studio Code (kurz VS Code) ist ein kostenloser Quelltext-Editor von Microsoft. Visual Studio Code ist plattform\u00fcbergreifend f\u00fcr die Betriebssysteme Windows, macOS und Linux verf\u00fcgbar und erm\u00f6glicht u.a. Syntaxhighlighting, Debugging, Autovervollst\u00e4ndigung und Versionsverwaltung.</p>"},{"location":"part1/#1-anmeldung-demoumgebung","title":"1 - Anmeldung Demoumgebung","text":"<p>Eine Demoumgebung ist bereitgestellt, ihr ben\u00f6tigt lediglich einen Laptop und Internetzugang.  </p> <p>     Workshop URL: https://catalog.partner.demo.redhat.com/workshop/h7hyqt     Workshop Passwort: n5qes36p </p> <p>Gib deine E-Mail-Adresse ein (du bekommst keine Post, dies dient lediglich der Zuordnung zu den einzelnen Workshop-Instanzen) und das entsprechende Workshop-Passwort, du wirst auf eine Workshop-\u00dcbersichtsseite mit einigen Links weitergeleitet.</p>"},{"location":"part1/#2-code-editor-vorbereiten","title":"2 - Code-Editor vorbereiten","text":"<p>Um den Code (das Ansible Playbook) anzupassen, verwendest du VSCode (eine IDE = Integrated Developer Environment), dort ist alles installiert was du zur Programmierung brauchst.</p> <p>Im Abschnitt \"2 -  image Visual Studio Code\", nutze den Link zu \"Console URL\". Kopiere dir das Passwort, du musst es einmal im n\u00e4chsten Tab eingeben.</p> <p>Es wird ein VS Code Editor im Browser gestartet, warte bis er vollst\u00e4ndig geladen ist.</p> <p>N\u00fctzliche VScode Konfiguration</p> <p>Farbschema f\u00fcr Syntax-Highlighting anpassen</p> <p>Die Ansible Extension unterst\u00fctzt Syntax-Highlighting f\u00fcr Ansible-Inhalte. Je nach verwendeten Theme von VScode wird dies m\u00f6glicherweise nicht korrekt angezeigt. Verwende das Dark+ Theme. Klicke auf File in der oberen Men\u00fcleiste, gehe auf Preferences, Theme und klicke auf Color Theme. Hier Dark+ (Default Dark+) w\u00e4hlen.</p> <p></p>"},{"location":"part1/#3-github-projekt-klonen","title":"3 - Github Projekt klonen","text":"<p>\u00d6ffne ein Terminal. In der Men\u00fcleiste Terminal w\u00e4hlen und auf New Terminal klicken. Im Terminal/der Linux-Kommandozeile das Github-Projekt mit dem Automatisierungs-Playbook klonen:</p> <pre><code>git clone https://github.com/TimGrt/IaC-Workshop-Uni-DuE.git\n</code></pre> <p>Tip</p> <p>Beim erstmaligen Einf\u00fcgen (rechte Maustaste) ist eine Best\u00e4tigung notwendig:</p> <p> </p> <p>Hier Zulassen w\u00e4hlen.</p> <p>Es entsteht ein neuer Ordner, diesen \u00fcber das Men\u00fcband File und Open Folder... \u00f6ffnen (<code>/home/student/IaC-Workshop-Uni-DuE/</code>). Das Browser-Fenster aktualisiert sich, auf der linken Seite ist eine Ordner- und Dateiansicht zu sehen. \u00d6ffne wieder ein Terminal wie zuvor, um sp\u00e4ter die Automatisierung ausf\u00fchren zu k\u00f6nnen.</p>"},{"location":"part2/","title":"Infrastructure as Code","text":"<p>Die Konfiguration der Automation Platform wird \u00fcber ein Ansible Playbook angepasst, du kannst das Playbook mit dem folgenden Kommando im Terminal/auf der Kommandozeile ausf\u00fchren:</p> <pre><code>ansible-playbook playbook_controller_automation.yml\n</code></pre> <p>Bei den ersten Ausf\u00fchrungen wirst du mit einigen Fehlermeldung konfrontiert, es fehlen Dependencies, Credentials und auch ein Teil der Automatisierung an sich.</p>"},{"location":"part2/#1-dependencies-installieren","title":"1 - Dependencies installieren","text":"<p>Wenn du versuchst das Playbook auszuf\u00fchren, wirst du die folgende Fehlermeldung erhalten:</p> <p>Failure</p> <pre><code>ERROR! Error loading module_defaults: could not resolve the module_defaults group awx.awx.controller\n</code></pre> <p>Es fehlen zur Ausf\u00fchrung notwendige Dependencies. Ansible Module werden in Collections hinterlegt (im Grunde eine spezielle Ordner-Struktur), sie k\u00f6nnen auf dem Controller mit einem CLI-Kommando installiert werden. Die Datei <code>requirements.yml</code> enth\u00e4lt den Namen der Collection, suche in der Ansible Dokumentation nach dem passenden Kommando und f\u00fchre es aus.</p> Hilfe n\u00f6tig? <p>Die fehlende Collection mit folgendem Kommando installieren:</p> <pre><code>ansible-galaxy collection install -r requirements.yml\n</code></pre> <p>Anschlie\u00dfend mit dem folgenden Kommando pr\u00fcfen:</p> <pre><code>ansible-galaxy collection list\n</code></pre> <p>Alles erledigt?</p> <ul> <li> Notwendige <code>awx.awx</code> Collection ist installiert.</li> </ul>"},{"location":"part2/#2-credentials-exportieren","title":"2 - Credentials exportieren","text":"<p>Um die AAP automatisieren zu k\u00f6nnen, muss sich das Playbook bei der Ausf\u00fchrung an der API anmelden, die notwendigen Credentials werden als Umgebungsvariablen \u00fcbergeben. Die folgenden drei Variablen m\u00fcssen definiert werden:</p> <ul> <li><code>CONTROLLER_HOST</code></li> <li><code>CONTROLLER_USERNAME</code></li> <li><code>CONTROLLER_PASSWORD</code></li> </ul> <p>Die Umgebungsvariablen werden auf der Kommandozeile mit dem <code>export</code> Kommando \u00fcbergeben, Key und Value werden durch ein Gleichzeichen (<code>=</code>) getrennt.</p> <pre><code>export CONTROLLER_USERNAME=admin\n</code></pre> <p>Exportiere alle drei Variablen. Nutze die Werte aus der Workshop-\u00dcbersichtsseite, f\u00fcr die Variable <code>CONTROLLER_HOST</code> die URL des Red Hat Ansible Automation Controller (Abschnitt 3) verwenden.</p> <p>Mit dem folgenden Kommando kannst du pr\u00fcfen ob die Variablen erfolgreich exportiert wurden:</p> <pre><code>env | grep CONTROLLER\n</code></pre> <p>Alles erledigt?</p> <ul> <li> AAP-API Credentials als Umgebungsvariablen exportiert (<code>CONTROLLER_HOST</code>, <code>CONTROLLER_USERNAME</code>, <code>CONTROLLER_PASSWORD</code>)</li> </ul>"},{"location":"part2/#3-automatisierung-anpassenvervollstandigen","title":"3 - Automatisierung anpassen/vervollst\u00e4ndigen","text":"<p>Die Automatisierung ist unvollst\u00e4ndig, wenn du das Playbook erneut ausf\u00fchrst, wird versucht ein Job-Template zu erstellen, welches auf ein nicht-existentes Project verweist.</p> <p>Failure</p> <pre><code>Request to /api/v2/projects/?name=Git+Repository+with+Ops+Playbooks returned 0 items, expected 1\n</code></pre> <p>Ein Project in der AAP zeigt auf ein Git-Repository, es enth\u00e4lt allen Code f\u00fcr die Automatisierung. Die AAP zieht sich den Code aus diesem und sorgt (durch die Auswahl einer Option) daf\u00fcr, dass vor jeder Ausf\u00fchrung der Automatisierung der aktuellste Stand geladen wird.</p> <p>Ein Ansible-Playbook besteht aus einer Liste an Tasks, du musst die fehlenden Tasks hinzuf\u00fcgen! Klicke links im File Explorer auf die Datei <code>playbook_controller_automation.yml</code>, ab Zeile 23 sind die einzelnen Tasks (Schritte/Aufgaben) beschrieben, um den AAP Controller in den gew\u00fcnschten Zielzustand zu versetzen.</p> playbook_controller_automation.yml<pre><code>---\n- name: Prepare Automation Controller # (1)!\n  hosts: localhost # (2)!\n  connection: local\n  module_defaults: # (3)!\n    group/awx.awx.controller:\n      controller_host: \"{{ lookup('env', 'CONTROLLER_HOST') }}\"\n      controller_username: \"{{ lookup('env', 'CONTROLLER_USERNAME') }}\"\n      controller_password: \"{{ lookup('env', 'CONTROLLER_PASSWORD') }}\"\n  pre_tasks: # (4)!\n    - name: Ensure required connection variables are defined\n      ansible.builtin.assert:\n        that:\n          - lookup('env', 'CONTROLLER_HOST') is defined\n          - lookup('env', 'CONTROLLER_HOST') | length &gt; 0\n          - lookup('env', 'CONTROLLER_USERNAME') is defined\n          - lookup('env', 'CONTROLLER_USERNAME') | length &gt; 0\n          - lookup('env', 'CONTROLLER_PASSWORD') is defined\n          - lookup('env', 'CONTROLLER_PASSWORD') | length &gt; 0\n        quiet: true\n        fail_msg: \"Variables for accessing Automation controller are missing! Export the variables.\"\n  tasks: # (5)!\n    - name: Ensure all hosts from web group are enabled\n      awx.awx.host:\n        name: \"{{ item }}\"\n        inventory: Workshop Inventory\n        enabled: true\n        validate_certs: true\n      loop:\n        - node1\n        - node2\n        - node3\n# ... most tasks are cut for readability...\n</code></pre> <ol> <li>Der Name des Playbooks, wird auf der CLI bei der Ausf\u00fchrung ausgegeben.</li> <li>Das Ziel der Automatisierung, standartm\u00e4\u00dfig kommuniziert Ansible per SSH. Da wir eine API ansprechen wollen, k\u00f6nnen wir gegen <code>localhost</code> mit der Verbindungsmethode <code>local</code> ausf\u00fchren.</li> <li>Einige Standart-Parameter welche alle Module der <code>awx.awx</code> Collection bekommen sollen. In diesem Fall sind es die Authentifizierungs-Parameter, in jedem Task wird ein neuer API-Call zur AAP gemacht.</li> <li>Eine Liste an Tasks (hier nur ein einzelner), welche definitiv vor allen anderen laufen sollen. In diesem Fall wird eine Pr\u00fcfung der Umgebungsvariablen gemacht, sollten sie fehlen, wird eine sprechende Fehlermeldung ausgeben.</li> <li>Ab hier startet die eigentliche Automatisierung der AAP! In dieser Liste (im YAML-Format beginnt jedes Listenelement mit <code>-</code>) m\u00fcssen alle Tasks in der richtigen Reihenfolge aufgef\u00fchrt werden.</li> </ol> <p>Suche in der Ansible Dokumentation nach dem passenden Modul zur Erstellung eines Projects.  </p> <p>Tip</p> <p>Nutze die Examples (Beispiele) auf der Dokumentations-Seite des Moduls, du kannst ein Beispiel kopieren und einf\u00fcgen, anschlie\u00dfend passt du die Parameter an und f\u00fcgst fehlende Parameter hinzu.</p> <p>Du musst sowohl das Project mit dem Operations-Content, als auch das Project mit dem Development-Content hinzuf\u00fcgen (insgesamt also zwei Tasks).</p> Key Value <code>name</code> <code>Add project with playbooks for Ops workloads</code> <code>default_environment</code> <code>Default execution environment</code> <code>scm_type</code> <code>git</code> <code>scm_url</code> <code>https://github.com/ansible/workshop-examples.git</code> <code>scm_branch</code> <code>webops</code> <code>scm_update_on_launch</code> <code>true</code> <code>scm_delete_on_update</code> <code>true</code> <code>scm_clean</code> <code>true</code> <code>state</code> <code>present</code> Key Value <code>name</code> <code>Add project with playbooks for Dev workloads</code> <code>default_environment</code> <code>Default execution environment</code> <code>scm_type</code> <code>git</code> <code>scm_url</code> <code>https://github.com/ansible/workshop-examples.git</code> <code>scm_branch</code> <code>webdev</code> <code>scm_update_on_launch</code> <code>true</code> <code>scm_delete_on_update</code> <code>true</code> <code>scm_clean</code> <code>true</code> <code>state</code> <code>present</code> <p>Warning</p> <p>Ein Ansible-Playbook wird sequentiell abgearbeitet, die Reihenfolge ist entscheidend! F\u00fcge die Tasks hinter dem Task <code>Ensure all hosts from web group are enabled</code>, aber vor dem Task <code>Create job template for infrastructure setup as Ops workload</code> ein. Playbooks sind im YAML-Format geschrieben, hier kommt es auf die passende Einr\u00fcckung an, alle Tasks m\u00fcssen auf der gleichen Ebene starten!</p> Hilfe n\u00f6tig? <p>Die folgenden beiden Tasks f\u00fcgen die notwendigen Project-Objekte hinzu:</p> <pre><code>- name: Add project with playbooks for Ops workloads\n  awx.awx.project:\n    name: Git Repository with Ops Playbooks\n    default_environment: Default execution environment\n    scm_type: git\n    scm_url: https://github.com/ansible/workshop-examples.git\n    scm_branch: webops\n    scm_update_on_launch: true\n    scm_delete_on_update: true\n    scm_clean: true\n    state: present\n\n- name: Add project with playbooks for Dev workloads\n  awx.awx.project:\n    name: Git Repository with Dev Playbooks\n    default_environment: Default execution environment\n    scm_type: git\n    scm_url: https://github.com/ansible/workshop-examples.git\n    scm_branch: webdev\n    scm_update_on_launch: true\n    scm_delete_on_update: true\n    scm_clean: true\n    state: present\n</code></pre> Gesamtes Playbook <pre><code>---\n- name: Prepare Automation Controller\n  hosts: localhost\n  connection: local\n  module_defaults:\n    group/awx.awx.controller:\n      controller_host: \"{{ lookup('env', 'CONTROLLER_HOST') }}\"\n      controller_username: \"{{ lookup('env', 'CONTROLLER_USERNAME') }}\"\n      controller_password: \"{{ lookup('env', 'CONTROLLER_PASSWORD') }}\"\n  pre_tasks:\n    - name: Ensure required connection variables are defined\n      ansible.builtin.assert:\n        that:\n          - lookup('env', 'CONTROLLER_HOST') is defined\n          - lookup('env', 'CONTROLLER_HOST') | length &gt; 0\n          - lookup('env', 'CONTROLLER_USERNAME') is defined\n          - lookup('env', 'CONTROLLER_USERNAME') | length &gt; 0\n          - lookup('env', 'CONTROLLER_PASSWORD') is defined\n          - lookup('env', 'CONTROLLER_PASSWORD') | length &gt; 0\n        quiet: true\n        fail_msg: \"Variables for accessing Automation controller are missing! Export the variables.\"\n  tasks:\n    - name: Ensure all hosts from web group are enabled\n      awx.awx.host:\n        name: \"{{ item }}\"\n        inventory: Workshop Inventory\n        enabled: true\n        validate_certs: true\n      loop:\n        - node1\n        - node2\n        - node3\n\n    - name: Add project with playbooks for Ops workloads\n      awx.awx.project:\n        name: Git Repository with Ops Playbooks\n        default_environment: Default execution environment\n        scm_type: git\n        scm_url: https://github.com/ansible/workshop-examples.git\n        scm_branch: webops\n        scm_update_on_launch: true\n        scm_delete_on_update: true\n        scm_clean: true\n        state: present\n\n    - name: Add project with playbooks for Dev workloads\n      awx.awx.project:\n        name: Git Repository with Dev Playbooks\n        default_environment: Default execution environment\n        scm_type: git\n        scm_url: https://github.com/ansible/workshop-examples.git\n        scm_branch: webdev\n        scm_update_on_launch: true\n        scm_delete_on_update: true\n        scm_clean: true\n        state: present\n\n    - name: Create job template for infrastructure setup as Ops workload\n      awx.awx.job_template:\n        name: Web App Deploy\n        job_type: run\n        inventory: Workshop Inventory\n        project: Git Repository with Ops Playbooks\n        execution_environment: Default execution environment\n        playbook: rhel/webops/web_infrastructure.yml\n        credentials:\n          - Workshop Credentials\n        limit: web\n        become_enabled: true\n\n    - name: Create job template for infrastructure setup as Dev workload\n      awx.awx.job_template:\n        name: Node.js Deploy\n        job_type: run\n        inventory: Workshop Inventory\n        project: Git Repository with Ops Playbooks\n        execution_environment: Default execution environment\n        playbook: rhel/webdev/install_node_app.yml\n        credentials:\n          - Workshop Credentials\n        limit: web\n        become_enabled: true\n\n    - name: Create DevOps workflow for infrastructure setup and Nginx deployment\n      awx.awx.workflow_job_template:\n        name: Deploy Webapp Server\n        destroy_current_nodes: true\n        workflow_nodes:\n          - identifier: Approve Deployment\n            unified_job_template:\n              name: Approve Deployment\n              type: workflow_approval\n            related:\n              success_nodes:\n                - identifier: Web App Deploy\n          - identifier: Web App Deploy\n            unified_job_template:\n              name: Web App Deploy\n              type: job_template\n            related:\n              success_nodes:\n                - identifier: Node.js Deploy\n          - identifier: Node.js Deploy\n            unified_job_template:\n              name: Node.js Deploy\n              type: job_template\n\n    - name: Launch workflow\n      awx.awx.workflow_launch:\n        workflow_template: Deploy Webapp Server\n        wait: false\n</code></pre> <p>Alles erledigt?</p> <ul> <li> Passendes Modul aus der Dokumentation identifiziert</li> <li> Task f\u00fcr Ops-Content Project hinzugef\u00fcgt</li> <li> Task f\u00fcr Dev-Content Project hinzugef\u00fcgt</li> </ul>"},{"location":"part2/#4-automatisierung-ausfuhren","title":"4 - Automatisierung ausf\u00fchren","text":"<p>Sobald alles vollst\u00e4ndig ist, kannst du die Automatisierung ausf\u00fchren. Im Terminal wieder das folgende Kommando ausf\u00fchren:</p> <pre><code>ansible-playbook playbook_controller_automation.yml\n</code></pre> <p>Du wirst die einzelnen Task-Beschreibungen mit einem gelben Changed-Status sehen (wenn die Objekte angelegt/angepasst) werden, wenn alle Tasks erfolgreich abgearbeitet sind endet der Playbook-Run mit einem Play Recap.</p>"},{"location":"part2/#5-automatisierung-bestatigen","title":"5 - Automatisierung best\u00e4tigen","text":"<p>Der Automatisierungs-Workflow erwartet (in unserem Fall) eine manuelle Best\u00e4tigung, diese kannst du \u00fcber das Web-UI der AAP ausf\u00fchren. Logge dich auf dem Controller der Ansible Automation Platform ein, nutze den Link f\u00fcr den AAP Controller von der Workshop-\u00dcbersichtsseite.</p> <p>Im Controller-UI, klicke links auf Workflow Approvals. Best\u00e4tige die Ausf\u00fchrung mit .</p> <p>Anschlie\u00dfend kannst du auf den Workflow Job klicken (im Screenshot <code>3 - Deploy Webapp Server</code>), es \u00f6ffnet sich eine Ansicht mit den einzelnen Workflow-Steps. Ebenfalls kannst du im linken Men\u00fc auf Jobs klicken und dort den Workflow Job ausw\u00e4hlen.</p> <p>Success</p> <p>Nach einer Weile ist der Workflow beendet, es wurden neue Server provisioniert, eine Grundkonfiguration wurde ausgebracht und anschlie\u00dfend ein nginx-Webserver gestartet.</p>"},{"location":"part3/","title":"Recap","text":"<p>Du hast einen kurzen Einblick in ein Automatisierungs-Projekt bekommen,</p> <p>Neben den gezeigten T\u00e4tigkeiten und Tools sind noch mindestens die folgenden Punkte Teil des normalen Arbeitsalltags eines Consultants:</p> <ul> <li>Call mit dem Kunden und den restlichen Teammitgliedern (Daily, Weekly, Stand-Ups, ...)</li> <li>Dokumentation schreiben (oft auch as Code wie dieser Workshop-Guide)</li> <li>Konzepte f\u00fcr Infrastructure as Code erarbeiten</li> <li>Git-Workflow (\u00c4dnerungen commiten, Merge Request erstellen, Code Reviews, ...)</li> <li>Container-Images (Execution Environments) erstellen, versionieren und ver\u00f6ffentlichen</li> <li>Plattform (Ansible Automation Platform) pflegen/administrieren (Platform aufbauen ist nat\u00fcrlich auch oft Bestandteil)</li> <li>CI/CD-Pipelines erstellen (z.B. f\u00fcr automatisiertes Testing der Playbooks oder auch automatisches Deployment der \u00c4nderungen)</li> <li>Kundenmitarbeiter schulen und anleiten</li> <li>...</li> </ul> <p>Und das ist nur ein kleiner Ausschnitt der T\u00e4tigkeiten aus dem Leben eines Automatisierungs-Consultants, die IT-Welt ist gro\u00df und vielf\u00e4ltig, je nach Einsatzbereich unterscheiden sich Tools und Anforderungen deutlich. Aber das macht es nat\u00fcrlich auch sehr spannend!</p>"}]}